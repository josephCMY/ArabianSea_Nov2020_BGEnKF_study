












  SUBROUTINE REGRESS_ONE(NX,XBAR,YBAR,XCOV,YCOV,XYCOV,NXEIGS,CCOF,CCOF0,RESERR,RESCOV,XVEC)

  USE RAD_BIAS
  IMPLICIT NONE
































  INTEGER, PARAMETER :: JWORK=4900
  INTEGER, PARAMETER :: JMPRED=70
  INTEGER            :: NXEIG  

  INTEGER, INTENT(IN) :: NX, NXEIGS
  INTEGER NXE

  REAL(KIND=LONG),    INTENT(IN) :: XBAR(NX), YBAR, XCOV(NX,NX), XYCOV(NX), YCOV

  REAL(KIND=LONG), INTENT(OUT) :: CCOF(NX), CCOF0
  REAL(KIND=LONG), INTENT(OUT) :: RESERR, RESCOV
  REAL(KIND=LONG), INTENT(OUT) :: XVEC(NX,NX)

  REAL(KIND=LONG) :: XDEV(NX), XXBAR(NX)
  REAL(KIND=LONG) :: YVEC, XVAL(NX), YVAL, DET, D(NX)
  REAL(KIND=LONG) :: XW1(NX,NX), XW2(NX,NX), YW1, XYW1(NX), YXW1(NX), XINV(NX,NX), XYW2(NX)
  REAL(KIND=LONG) :: W1(JWORK)

  INTEGER :: IFAIL = 0
  INTEGER :: IPIV(JMPRED)
  INTEGER :: NWORK = JWORK

  INTEGER :: J, JJ, I, II
  REAL    :: RR

  REAL(KIND=LONG)  :: offdiag(NX)
  NXE=1
  NXEIG=NX

  CCOF=0.
  XVEC=0.
     D=0.


  IF ((NX < 1) .OR. (NX > JMPRED)) STOP 701
  IF ((NXEIG < 1) .OR. (NXEIG > NX)) STOP 702






  DO I=1, NX
    XDEV(I) = SQRT(XCOV(I,I))
  ENDDO

  PRINT *, 'PREDICTOR STD DEV AND MEAN NEW  F02FAF'
  PRINT 99, XDEV(1:NX)
  PRINT 99, XBAR(1:NX)





















  XVEC=XCOV


  call tred2(XVEC,NX,NX,XVAL,offdiag)

  call tqli(XVAL,offdiag,NX,NX,XVEC)

  IF (IFAIL /= 0) THEN 
    PRINT *, 'PROBLEM WITH PREDICTOR EIGENVALUE CALCULATION'
    STOP
  ENDIF

  PRINT 89
  89 FORMAT (/1X,'XVAL = EIGENVALUES OF PREDICTOR in one and two zero')
  PRINT 99, XVAL(1:NX)
  99 FORMAT (1X,10F12.4)

  PRINT *, 'EIGENVECTORS OF PREDICTOR BY COLUMN'
   XVEC(1:NX,1:(NXEIG-NXEIGS))=0
  DO I=1, NX
    PRINT 99, XVEC(I,1:NX)
    
  ENDDO

  XXBAR = MATMUL(XBAR,XVEC)
  PRINT *, 'MEAN VALUE OF PREDICTORS IN XVEC SPACE'
  PRINT 99, XXBAR(1:NX)

  XYW1 = MATMUL(XYCOV,XVEC)



  D(NXE:NXEIG) = XYW1(NXE:NXEIG)/XVAL(NXE:NXEIG)




  CCOF = MATMUL(XVEC(:,NXE:NXEIG),D(NXE:NXEIG))





  CCOF0 = YBAR - SUM(CCOF(NXE:NX)*XBAR(NXE:NX))











  XYW1=0
  XYW1(NXE:NXEIG) = MATMUL(XYCOV,XVEC(:,NXE:NXEIG))
  XYW1(NXE:NXEIG) = XYW1(1:NXEIG) * XYW1(NXE:NXEIG)
  XYW1(NXE:NXEIG) = XYW1(1:NXEIG)/XVAL(NXE:NXEIG)

  PRINT *, 'EXPLANATION OF VARIANCE'
  PRINT 99, YCOV
  PRINT *, ' '
  PRINT 99, 1.0
  DO I=1, NXEIG
    PRINT 99, XYW1(I)/YCOV
  ENDDO
  PRINT 99, (YCOV - SUM(XYW1(1:NXEIG)))/YCOV
  PRINT *, ' '
  PRINT 99, YCOV - SUM(XYW1(1:NXEIG))








  YXW1 = CCOF
  XYW1 = MATMUL(CCOF,XCOV)
  XYW1 = XYW1 - 2*XYCOV
  RESCOV = YCOV + DOT_PRODUCT(XYW1,YXW1)


  RR = RESCOV
  IF (RR < 0.0) THEN
    PRINT 51, I, RR
    51 FORMAT (/1X,'RES ERR COV FOR ELEMENT',I5,' = ',E12.4/1X,'SET TO ZERO')
    RR=0.0
  ENDIF
  RESERR = SQRT(RR)






  RETURN
  END SUBROUTINE REGRESS_ONE
